%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ex{Step-up and (synchronous) buck-boost converters}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: Boost Converter with no losses %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task {Boost converter with no losses}
The boost converter which is shown in \autoref{fig:boost converter with no losses} supplies a resistive load with a rated voltage of $U_{\mathrm{2}} = \SI{60}{\volt}$. The converter operates in steady state and all losses of the boost converter are neglected.

\input{./fig/ex02/Fig_boostConverter.tex}

The specification of the boost converter is given in \autoref{table:ex02_Parameters of the circuit}.

\begin{table}[ht]
    \centering  % Zentriert die Tabelle
    \begin{tabular}{llll}
        \toprule
        
        Input voltage: &  $U_{\mathrm{1}} = \SI{12}{\volt}$ & Output voltage: & $U_{\mathrm{2}} = \SI{60}{\volt}$ \\ 
        Output current: & $I_2 = \SI{2}{A}$  & Minimal output power: & $P_{\mathrm{2,min}} = \SI{10}{\watt}$ \\ 
        Output voltage ripple: & $\triangle u_{\mathrm{2}} = \SI{120}{\milli\volt}$  & Switching frequency: & $f_{\mathrm{s}} = \SI{100}{\kilo\hertz}$ \\ 
        \bottomrule
    \end{tabular}
    \caption{Parameters of the boost converter.}  % Beschriftung der Tabelle
    \label{table:ex02_Parameters of the circuit}
\end{table}
%
\subtask{Derive the duty cycle $D$ which leads to the specific output voltage of $U_{\mathrm{2}} = \SI{60}{\volt}$.}

\begin{solutionblock}
    \input{./fig/ex02/Fig_ECDTeTa.tex}
    The equivalent circuit diagram (ECD) is shown in \autoref{fig:switching_states_step-down_converter-Ex02}.
    As there are no losses at the transistor, the voltage $U_{\mathrm{1}}$ is equal to $u_{\mathrm{L}}$ for the switch-on period $T_{\mathrm{on}}$ and is defined as
    \begin{equation}
        U_{\mathrm{1}} = \overline u_{\mathrm{L}} = L \frac{\Delta i_{\mathrm{L}} }{\Delta t}. 
    \end{equation} 
    This is an approximation of the total differential using a difference equation with the differences $\Delta $. This results in the component differential equations becoming average value equations. This subtask does not consider the complete period $T_{\mathrm{s}}$, but only the switch-on period $T_{\mathrm{on}}$. Furthermore, the initial state of the current $i_{\mathrm{L}}$ must also be considered.
    That is why we can completely rearrange the equation into:
    \begin{equation}
        i_{\mathrm{L}}(T_{\mathrm{on}}) =  \frac{U_{\mathrm{1}} }{L}T_{\mathrm{on}} +  i_{\mathrm{L}}(0).
    \end{equation}
    Applying Kirchhoff's second law, the voltage equation for  the switch-off time $T_{\mathrm{off}}$ is given with:
    \begin{equation}
        U_{\mathrm{1}} = u_{\mathrm{L}} + U_{\mathrm{2}}.
    \end{equation}
    Now, the differential expression for $u_{\mathrm{L}}$ leads to:
    \begin{equation}
        L \frac{\Delta i_{\mathrm{L}} }{\Delta t} = U_{\mathrm{1}} - U_{\mathrm{2}}.
    \end{equation}
    The equation for the current $i_{\mathrm{L}}$ at the switch-off time $T_{\mathrm{off}}$ results from the term describing the discharge of the inductance from $T_{\mathrm{off}}$ together with the initial condition of the current at this time
    \begin{equation}
        i_{\mathrm{L}}(t) = \frac{U_{\mathrm{1}}-U_{\mathrm{2}} }{L} (t-T_{\mathrm{on}})+i_{\mathrm{L}}(T_{\mathrm{on}}).
    \end{equation}
    This results in the equation for the entire current curve over the period: 
    \begin{equation}
        i_{\mathrm{L}}(t) = \frac{U_{\mathrm{1}}-U_{\mathrm{2}} }{L} (t-T_{\mathrm{on}})+\frac{U_{\mathrm{1}}}{L}T_{\mathrm{on}}+i_{\mathrm{L}}(0).
    \end{equation}
    If one considers the steady state $i_{\mathrm{L}}(t=0)=i_{\mathrm{L}}(t=T_{\mathrm{s}})$, this results in
    \begin{equation}
        i_{\mathrm{L}}(0) = \frac{U_{\mathrm{1}}-U_{\mathrm{2}} }{L} (T_{\mathrm{off}})+\frac{U_{\mathrm{1}}}{L}T_{\mathrm{on}}+i_{\mathrm{L}}(0).
    \end{equation}
    Next $i_{\mathrm{L}}(0)=0$ cancels due to a subtraction
    \begin{equation}
        0 = \frac{U_{\mathrm{1}}-U_{\mathrm{2}} }{L} (T_{\mathrm{off}})+\frac{U_{\mathrm{1}}}{L}T_{\mathrm{on}}.
    \end{equation}
    Canceling out the inductance leads to
    \begin{equation}
        U_{\mathrm{1}}T_{\mathrm{on}}= (-U_{\mathrm{1}}+U_{\mathrm{2}})T_{\mathrm{off}},
    \end{equation}
    and rearranging to:
    \begin{equation}
        U_{\mathrm{1}}(T_{\mathrm{off}}+T_{\mathrm{on}})=  U_{\mathrm{2}}T_{\mathrm{off}}.
    \end{equation}
    The switch-off period $T_{\mathrm{off}}$ plus the switch-on period $T_{\mathrm{on}}$ is the total period $T_{\mathrm{s}}$. Hence, the following equation can be found for the input-output voltage gain:
    \begin{equation}
        \frac{U_{\mathrm{1}}}{U_{\mathrm{2}}}= \frac{T_{\mathrm{off}}}{T_{\mathrm{s}}}= \frac{T_{\mathrm{s}}}{T_{\mathrm{s}}}-\frac{T_{\mathrm{on}}}{T_{\mathrm{s}}} = 1-D.
    \end{equation}
    And with the values given in the task, the duty cycle is calculated as follows:
    \begin{equation}
        D = 1-\frac{U_{\mathrm{1}}}{U_{\mathrm{2}}} = 1- \frac {\SI{12}{\volt}} {\SI{60}{\volt}} = 0.8.
    \end{equation}
\end{solutionblock}


\subtask{Determine the average input current $\overline i_{\mathrm{L}}$.}
\begin{solutionblock}
    With neglecting the losses $(P_{\mathrm{l}} = \SI{0}{\watt})$ of the boost converter and assuming a sufficient filtering of the inductor current, the average value $\overline i_{\mathrm{L}}$ is equal $I_{\mathrm{1}}$ and can be calculated using the power balance
    \begin{equation}
        P_{\mathrm{2}} = U_{\mathrm{2}} I_{\mathrm{2}} = {\SI{60}{\volt}} \cdot {\SI{2}{\ampere}} = {\SI{120}{\watt}}.
    \end{equation}
    Since no losses are considered, the power  $P_{\mathrm{1}}$ is equal to  $P_{\mathrm{2}}$.
    This results in the average current $\overline i_{\mathrm{L}}$:
    \begin{equation}
         I_{\mathrm{1}} = \overline i_{\mathrm{L}} = \frac{P_{\mathrm{1}}}{U_{\mathrm{1}}}= \frac{\SI{120}{\watt}}{\SI{12}{\volt}} = \SI{10}{\ampere}.
    \end{equation}
    An alternative solution would be to determine the average current $\overline i_{\mathrm{L}}$ via the duty cycle
    \begin{equation}
    \frac{I_{\mathrm{1}}}{I_{\mathrm{2}}}=\frac{1}{1-D}.
    \end{equation}
    \begin{equation}
     I_{\mathrm{1}}=\frac{I_{\mathrm{2}}}{1-D}=\frac{\SI{2}{\ampere}}{1-0.8}= \SI{10}{\ampere}.
    \end{equation}
\end{solutionblock}

\subtask{ Define a suitable inductance for the coil $L$, so that the boost converter is operating in boundary conduction mode (BCM) when supplying the minimum output power $P_\mathrm{2,min}$. Determine the maximal switch-off current $i_{\mathrm{T}}$ of the transistor $T$ for the rated output current $I_{\mathrm{2}} = \SI{2}{\ampere}$.}
\begin{solutionblock}
    Because no losses are assumed, $P_{\mathrm{1,min}}=P_{\mathrm{2,min}}$ follows. The average current $I_{\mathrm{1,min}}$ over a period to achieve the minimum input power is
    \begin{equation}
        I_{\mathrm{1,min}} = \frac{P_{\mathrm{1,min}}}{U_{\mathrm{1}}} = \frac{\SI{10}{\watt}}{\SI{12}{\volt}}= \SI{0.833}{\ampere}.
    \end{equation}
    The requirement for BCM is that the current is zero at the starting point of the period  $i_\mathrm{1,BCM}(t=0)=\SI{0}{\ampere}$.
    Due to the triangular current waveform of the inductor current $i_{\mathrm{L}}$, the maximum current is given with:
    \begin{equation}
        i_\mathrm{1,BCM}(T_{\mathrm{on}})= 2I_{\mathrm{1,min}}= 2\cdot \SI{0.833}{\ampere} = \SI{1.667}{\ampere}.
    \end{equation}
    The differential equation of the inductance is defined as:
    \begin{equation}
        u_\mathrm{L}=L\frac{\mathrm{d}i_\mathrm{L}(t)}{\mathrm{d}t}.
    \end{equation}
    Neglecting saturation, the equation simplifies to:
    \begin{equation}
        \overline u_\mathrm{L}=L\frac{\Delta i_\mathrm{L}}{\Delta t}.
    \end{equation}
    Above $\frac{\Delta i_\mathrm{L}}{\Delta t}$ is the average current change over a time interval $\Delta t$. Only the switch-on period is considered, therefore $\Delta t = T_{\mathrm{on}}$. Furthermore, $u_\mathrm{L}=U_\mathrm{1}$ and $\Delta i_\mathrm{L} = 2 I_\mathrm{1,min}$.
    The switch-on period can be determined by the known duty cycle $D$ and the known frequency $f_{\mathrm{s}}$
    \begin{equation}
        T_{\mathrm{on}} = D T_{\mathrm{s}} = \Delta t = \frac{D}{f_{\mathrm{s}}} = \frac{0.8}{\SI{100}{\kilo\hertz}}=\SI{8}{\micro\second}.
    \end{equation}
    The following equation can be derived from the difference quotient equation as:
    \begin{equation}
        L=\frac{\Delta t u_\mathrm{L} }{\Delta i_\mathrm{L}}= \frac{D U_\mathrm{1}}{f_{\mathrm{s}}2I_{\mathrm{1,min}}} = \frac{0.8 \cdot \SI{12}{\volt}}{\SI{100}{\kilo\hertz\cdot 2\cdot \SI{1.667}{\ampere}}} = \SI{57.6}{\micro\henry}.
    \end{equation}
    The maximum current flows through the transistor at the end of the switch-on interval
    \begin{equation}
        I_\mathrm{T,max} = i_\mathrm{1,BCM}(T_{\mathrm{on}}) = \SI{1.667}{\ampere}.
    \end{equation}
\end{solutionblock}

\subtask{Calculate a suitable capacitance to meet the output voltage ripple specification. Determine the current stress of the capacitor $I_\mathrm{C,RMS}$.}
\begin{solutionblock}
    The reaction of the voltage fluctuation on the current fluctuation is neglected. During on-state of the transistor, the output capacitor feed the load. Assuming an constant output current and an ideal capacitor, the output can be adopted as linearly decreasing for this interval.

    The differential form of the capacitor equation is used for this task
    \begin{equation}
        i_\mathrm{C}=C \frac{\mathrm{d}u_\mathrm{c}(t)}{\mathrm{d}t}.
    \end{equation}
    Simplifications can be assumed as:
    \begin{equation}
       \overline i_\mathrm{C}=C \frac{\Delta u_\mathrm{c}}{\Delta t}.
    \end{equation}
    Here it is repeatedly considered that $\frac{\Delta u_\mathrm{C}}{\Delta t}$ is the average voltage change over a time interval $\Delta t$.
    In addition, $i_\mathrm{C}=I_\mathrm{2}$ and $\Delta u_\mathrm{c}=\Delta u_\mathrm{2}$ for $T_\mathrm{on}$ applies.
    $\Delta t$ is again equal to the switch-on period and can be represented by the following equation
    \begin{equation}
        \Delta t = \frac{D}{f_\mathrm{s}}. 
    \end{equation}
    Now that everything is known, the capacitance can be determined as
    \begin{equation}
        C = \frac{I_\mathrm{2}\Delta t}{\Delta u_\mathrm{2}}= \frac{I_\mathrm{2}D}{\Delta u_\mathrm{2}f_\mathrm{s}}=\frac{\SI{2}{\ampere}\cdot 0.8}{\SI{120}{\milli\volt} \cdot \SI{100}{\kilo\hertz}}=\SI{133.333}{\micro\farad}.
    \end{equation}
      During off-state the capacitor is charged with the current $i_\mathrm{1}-i_\mathrm{2}$. The average of the capacitor current is zero. An important rule during dimensioning the capacitor is the RMS value of the current. The RMS value of the current is determined using the following equation
     \begin{equation}
        I_\mathrm{C}=\sqrt{\frac{1}{T_\mathrm{s}}\int_{0}^{T_\mathrm{s}}i_\mathrm{C}^2(t)\mathrm{d}t}.
     \end{equation}
     Considering the switch-on and switch-offs periode, we can rewrite as:
     \begin{equation}
        I_\mathrm{C}=\sqrt{\frac{1}{T_\mathrm{s}}\int_{0}^{DT_\mathrm{s}}i_\mathrm{C}^2(t)\mathrm{d}t+\frac{1}{T_\mathrm{s}}\int_{DT_\mathrm{s}}^{T_\mathrm{s}}i_\mathrm{C}^2(t)\mathrm{d}t}.
     \end{equation}
     While neglecting the current ripple, one receives:
     \begin{equation}
        I_\mathrm{C}=\sqrt{D (I_\mathrm{2})^2+(1-D)(I_\mathrm{1}-I_\mathrm{2})^2}=\sqrt{0.8\cdot (\SI{2}{\ampere})^2+(1-0.8)\cdot(\SI{10}{\ampere}-\SI{2}{\ampere})^2} = \SI{4}{\ampere}. \label{eq:neglecting the current ripple}
     \end{equation}
     The current ripple causes an additional fluctuation in the current through the capacitor, which leads to a higher RMS value. The following equation is used for the current ripple
     \begin{equation}
        I_\mathrm{C}=\sqrt{D (I_\mathrm{2})^2\left[1+\frac{1}{3}\left[\frac{\Delta i_\mathrm{L}}{2I_\mathrm{2}}\right]^2\right]+(1-D)(I_\mathrm{1}-I_\mathrm{2})^2\left[1+\frac{1}{3}\left[\frac{\Delta i_\mathrm{L}}{2(I_\mathrm{1}-I_\mathrm{2})}\right]^2\right]} 
    \end{equation}
    \begin{equation}
        I_\mathrm{C}=\sqrt{0.8 \cdot (\SI{2}{\ampere})^2 \left[1+\frac{1}{3}\left[\frac{\SI{0.833}{\ampere}}{2\cdot (\SI{2}{\ampere})}\right]^2\right]+(1-0.8)(\SI{10}{\ampere}- \SI{2}{\ampere})^2\left[1+\frac{1}{3}\left[\frac{\SI{0.833}{\ampere}}{2(\SI{10}{\ampere}- \SI{2}{\ampere})}\right]^2\right]}=\SI{4.023}{\ampere}. \label{eq:with curret ripple}
    \end{equation}
    As the effective value (RMS) of currents increases due to fluctuations, the value of $ I_\mathrm{C}$ in \eqref{eq:with curret ripple} is slightly higher than in \eqref{eq:neglecting the current ripple}.
\end{solutionblock}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: Boost Converter with losses %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task{Boost converter with losses}
Next, the impact of power losses on the above's converter behavior is investigated. For the following points an ideally smoothed input current and a ripple-free output voltage are assumed. The boost converter with losses  is shown in \autoref{fig:boost converter with losses}.

\input{./fig/ex02/Fig_boostConverterlosses.tex}

\subtask{From now on, the influence of the resistor $R_\mathrm{L}$ is considered. Derive the efficiency $\eta$ and voltage ratio $U_\mathrm{1}/U_\mathrm{2}$ of the boost converter in dependence on the duty cycle $D$ and the resistance ratio $\alpha= R_\mathrm{L}/R$. Sketch both functions, $\eta$ and  $U_\mathrm{2}/U_\mathrm{1}$ over the duty cycle $D$ and analyze the findings.} 
\begin{solutionblock}
We are looking for: $\eta= F(D,\alpha)$ and $\frac{U_\mathrm{2}}{U_\mathrm{1}}=F(D,\alpha)$ with $\alpha=\frac{R_\mathrm{L}}{R}$.
Assuming a good smoothing of the inductor current yields to $I_\mathrm{L}=\overline i_\mathrm{L}=i_\mathrm{L}(t)$.
The efficiency is given by the following equation
\begin{equation}
    \eta = \frac{P_\mathrm{2}}{P_\mathrm{1}} = \frac{P_\mathrm{2}}{P_\mathrm{2}+P_\mathrm{l}} = \frac{U_\mathrm{2} I_\mathrm{2}}{U_\mathrm{2} I_\mathrm{2} +R_\mathrm{L} I_\mathrm{L}^2} \label{eq:efficiency}.
\end{equation}
It must be noted that the capacitor is charged when it is switched off and discharged when it is switched on. The same applies to the inductor, which discharges when it is switched off. The following equation can be created from these boundary conditions
\begin{equation}
    I_\mathrm{2}=\frac{1}{T_\mathrm{s}} \int_{0}^{DT_\mathrm{s}} i_\mathrm{C, discharge}(t)\mathrm{d}t-\frac{1}{T_\mathrm{s}} \int_{DT_\mathrm{s}}^{T_\mathrm{s}} i_\mathrm{C,charge}(t)\mathrm{d}t+\frac{1}{T_\mathrm{s}} \int_{DT_\mathrm{s}}^{T_\mathrm{s}} I_\mathrm{L}(t)\mathrm{d}t.
\end{equation}
As the charging and discharging currents of the capacitor are the same, they cancel each other out
\begin{equation}
    0 = \frac{1}{T_\mathrm{s}} \int_{0}^{DT_\mathrm{s}} i_\mathrm{C, discharge}(t)\mathrm{d}t-\frac{1}{T_\mathrm{s}} \int_{DT_\mathrm{s}}^{T_\mathrm{s}} i_\mathrm{C,charge}(t)\mathrm{d}t.
\end{equation}
This simplifies the expression to
\begin{equation}
    I_\mathrm{2}= \frac{1}{T_\mathrm{s}} \int_{DT_\mathrm{s}}^{T_\mathrm{s}} I_\mathrm{L}(t)\mathrm{d}t.
\end{equation}
As described in the task description, the current $I_\mathrm{L}$ is independent of $t$, so the integral can be solved as follows:
\begin{equation}
    I_\mathrm{2}= \frac{I_\mathrm{L}}{T_\mathrm{s}}(T_\mathrm{s}-(DT_\mathrm{s}))=I_\mathrm{L}(1-D) \label{eq:current_1}.
\end{equation}
Next, we insert \eqref{eq:current_1} into \eqref{eq:efficiency} and receive:
\begin{equation}
    \eta=\frac{U_\mathrm{2}I_\mathrm{2}}{U_\mathrm{2}I_\mathrm{2}+\frac{ R_\mathrm{L}I_\mathrm{2}^2}{(1-D)^2}}=\frac{U_\mathrm{2}}{U_\mathrm{2}+\frac{ R_\mathrm{L}I_\mathrm{2}}{(1-D)^2}}=\frac{RI_\mathrm{2}}{RI_\mathrm{2}+\frac{ R_\mathrm{L}I_\mathrm{2}}{(1-D)^2}}=\frac{R}{R+\frac{ R_\mathrm{L}}{(1-D)^2}}=\frac{1}{1+\frac{\alpha}{(1-D)^2}}.
    \label{eq:efficiencyOverD}
\end{equation}
The efficiency is defined as:
\begin{equation}
    \eta=\frac{P_\mathrm{2}}{P_\mathrm{1}} = \frac{U_\mathrm{2}I_\mathrm{2}}{U_\mathrm{1}I_\mathrm{L}}.
\end{equation}
Rearranging leads to:
\begin{equation}
    \frac{U_\mathrm{2}}{U_\mathrm{1}}=\eta \frac{I_\mathrm{L}}{I_\mathrm{2}}= \eta \frac{1}{(1-D)}=\frac{1}{1+\frac{\alpha}{(1-D)^2}}\frac{1}{1-D}=\frac{1}{(1-D)+\frac{\alpha}{1-D}}\cdot \frac{(1-D)}{(1-D)}=\frac{1-D}{(1-D)^2+\alpha}.
    \label{eq:voltageRatioOverD}
\end{equation}
This results for $\eta$ as a function of D and $\alpha$ given as:
\begin{equation}
    \eta(D,\alpha)=\frac{1}{1+\frac{\alpha}{(1-D)^2}}.
\end{equation}
Moreover, the voltage transfer ration $\frac{U_\mathrm{2}}{U_\mathrm{1}}$ as a function of D and $\alpha$ follows as:
\begin{equation}
    \frac{U_\mathrm{2}}{U_\mathrm{1}}(D,\alpha)=\frac{1-D}{(1-D)^2+\alpha}.
\end{equation}
\end{solutionblock}

\subtask{For $R_\mathrm{L}=\SI{0.2}{\ohm}$, determine the required duty cycle value for the given input and output voltages.}
\begin{solutionblock}
Defining the auxillary duty cycle $D_\mathrm{P}=1-D$ we can rewrite the voltage gain expression as: $\frac{U_\mathrm{2}}{U_\mathrm{1}}=\frac{D_\mathrm{P}}{(D_\mathrm{P})^2+\alpha}$.
As this expression is a quadratic term, the quadratic formula  can be used to solve for $D_\mathrm{P}$
\begin{equation}
    \frac{U_\mathrm{2}}{U_\mathrm{1}}(D_\mathrm{P})^2-D_\mathrm{P}+\frac{U_\mathrm{2}\alpha}{U_\mathrm{1}}=0,
\end{equation}
\begin{equation}
    D_\mathrm{P}^2 - \frac{U_\mathrm{1}}{U_\mathrm{2}} D_\mathrm{P}+\alpha=0. \label{eq:dutycycle under consideration of inductor losses}
\end{equation}
The first term resulting from \eqref{eq:dutycycle under consideration of inductor losses} is:
\begin{equation}
    D_\mathrm{P1}=\frac{1}{2}\frac{U_\mathrm{1}}{U_\mathrm{2}}+\sqrt{\left(\frac{1}{2}\frac{U_\mathrm{1}}{U_\mathrm{2}}\right)^2-\alpha}= \frac{1}{2}\cdot\frac{\SI{12}{\volt}}{\SI{60}{\volt}}+\sqrt{\left({\frac{1}{2}}\cdot\frac{\SI{12}{\volt}}{\SI{60}{\volt}}\right)^2-\frac{\SI{0.2}{\ohm}}{\SI{30}{\ohm}}}= 0.158.
\end{equation}
If one inserts this into the equation $D_\mathrm{1}=1-D_\mathrm{P1}$, one gets the result $D_\mathrm{1}=0.842$.

The second term resulting from \eqref{eq:dutycycle under consideration of inductor losses} is:
\begin{equation}
    D_\mathrm{P2}=\frac{1}{2}\frac{U_\mathrm{1}}{U_\mathrm{2}}-\sqrt{\left(\frac{1}{2}\frac{U_\mathrm{1}}{U_\mathrm{2}}\right)^2-\alpha}= \frac{1}{2}\cdot\frac{\SI{12}{\volt}}{\SI{60}{\volt}}-\sqrt{\left({\frac{1}{2}}\cdot\frac{\SI{12}{\volt}}{\SI{60}{\volt}}\right)^2-\frac{\SI{0.2}{\ohm}}{\SI{30}{\ohm}}}= 0.042.
\end{equation}
Leading to $D_\mathrm{2}=0.958$ the duty cycle is only a theoretical value as one can find from the following loss analysis: The inductor currents for the two above consdered cases are:
\begin{equation}
    I_\mathrm{L1} = \frac{I_\mathrm{2}}{1-D_\mathrm{1}}= \frac{\SI{2}{\ampere}}{1-0.842}=\SI{12.679}{\ampere},
\end{equation}
\begin{equation}
    I_\mathrm{L2} = \frac{I_\mathrm{2}}{1-D_\mathrm{2}}= \frac{\SI{2}{\ampere}}{1-0.958}=\SI{47.321}{\ampere}.
\end{equation}
Putting these current values in relation to the losses, the following can be determined by using the relation $P=I^2R$:
\begin{equation}
    \frac{(\SI{47.321}{\ampere})^2}{(\SI{12.679}{\ampere})^2}=13.9296.
\end{equation}
The losses are 14 times higher by a duty cycle of $D_\mathrm{2}=0.958$ compared to $D_\mathrm{1}=0.842$. 

The voltage ratio dependant on the duty cycle $D$ is shown in \autoref{fig:voltageRatioAndEfficiency} on the left side. Both functions for the loss-free and lossy operation are visualized. Moreover, on the right side of \autoref{fig:voltageRatioAndEfficiency} the resulting efficiency cures are shown.

    \input{fig/ex02/sFig_boost_voltage_efficiency.tex}

\end{solutionblock}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subtask{Calculate the efficiencies $\eta_1(D_1)$ and $\eta_2(D_2)$ of the boost converter for an output current of $\SI{2}{\ampere}$ and a coil resistance of $R_{\mathrm{L}} = \SI{0.2}{\Omega}$.}

\begin{solutionblock}
    With the previous calculated duty cycles, the efficiency is determined with \eqref{eq:efficiencyOverD} for $D_{\mathrm{1}} = 0.842$ by
    \begin{equation}
        \eta_{\mathrm{1}} = \frac{1}{1+\frac{\frac{\SI{0.2}{\Omega}}{\SI{30}{\Omega}}}{\left(1-0.842\right)^2}} = 0.789,
    \end{equation}
    and, with the second duty cycle $D_2 = 0.958$ the efficiency results into:
    \begin{equation}
        \eta_{\mathrm{2}} = \frac{1}{1+\frac{\frac{\SI{0.2}{\Omega}}{\SI{30}{\Omega}}}{\left(1-0.958\right)^2}} = 0.211.
    \end{equation}

\end{solutionblock}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subtask{In addition, consider the conduction losses of the diode $D$ and the transistor $T$. Assume an equivalent resistance of $R_{\mathrm{D}} = \SI{0.5}{\milli\Omega}$ and forward voltage of $U_{\mathrm{D}} = \SI{1}{\volt}$ for the diode and an equivalent resistance of $R_{\mathrm{DS,on}} = \SI{30}{\milli\Omega}$ for the transistor. Determine the required duty cycle value when the conduction losses are considered.}

\begin{solutionblock}
    Considering the losses, the equation is extended with the loss terms by
    \begin{equation}
        U_1 I_{\mathrm{L}} = U_2 I_2 + R_{\mathrm{L}} I_{\mathrm{L}}^2 + R_{\mathrm{DS,on}} I_{\mathrm{T}}^2 + U_{\mathrm{th}} \overline{i}_{\mathrm{D}} + R_{\mathrm{D}} I_{\mathrm{D}}^2,
        \label{eq:powerBalanceBoostConverterWithLosses}
    \end{equation}
    with the average diode current $\overline{i}_{\mathrm{D}}$ and the RMS diode current $I_{\mathrm{D}}$. The diode RMS current is determined as:
    \begin{equation}
        I_{\mathrm{D}} = \sqrt{\frac{1}{T} \int_{0}^{T} i_{\mathrm{D}}(t)^2 \mathrm{d}t}
        = \sqrt{\frac{1}{T} \left( \int_{0}^{T_{\mathrm{on}}} 0 \mathrm{d}t + \int_{T_{\mathrm{on}}}^{T_{\mathrm{s}}} I_{\mathrm{L}}(t)^2 \mathrm{d}t \right)}
        = \sqrt{\frac{{T_{\mathrm{s}}-T_{\mathrm{on}}}}{T_{\mathrm{s}}}I_{\mathrm{L}}^2}
        = \sqrt{1-D}I_{\mathrm{L}}.
    \end{equation}
    
    Moreover, the average diode current is calculated with
    \begin{equation}
        \overline{i}_{\mathrm{D}} = (1-D)I_{\mathrm{L}} = I_2,
        \label{eq:avgCurrentDiode}
    \end{equation}

    and, the current through the transistor is given by:
    \begin{equation}
        I_{\mathrm{T}} = \sqrt{\frac{1}{T} \int_{0}^{T} i_{\mathrm{T}}(t)^2 \mathrm{d}t}
        = \sqrt{\frac{1}{T_{\mathrm{s}}}\left(\int_{0}^{T_{\mathrm{on}}} I_{\mathrm{L}}^2 \mathrm{d} t + \int_{T_{\mathrm{on}}}^{T_{\mathrm{s}}} 0 \mathrm{d} t \right)}
        = \frac{T_{\mathrm{on}}}{T_{\mathrm{s}}}I_{\mathrm{L}}^2
        = \sqrt{D} I_{\mathrm{L}}.
    \end{equation}

    Next, the currents in \eqref{eq:powerBalanceBoostConverterWithLosses} are replaced with $I_{\mathrm{2}}$, which leads to
    \begin{equation}
        \frac{U_1 I_2}{1 -D} = U_2 I_2 + R_{\mathrm{L}}\frac{I_2^2}{\left(1-D\right)^2} + R_{\mathrm{DS,on}} \frac{D I_2^2}{\left(1-D\right)^2} + U_{\mathrm{th}}I_2 + R_{\mathrm{D}}\frac{I_2^2}{1-D},
    \end{equation}
    with $I_2 = \frac{U_2}{R}$ and $D_{\mathrm{p}} = 1-D$ yields:
    \begin{equation}
        U_1 D_{\mathrm{p}} = U_2 D_{\mathrm{p}}^2 + \frac{R_{\mathrm{L}}}{R} U_2 + (1-D_{\mathrm{p}}) \frac{R_{\mathrm{DS,on}}}{R}U_2 + U_{\mathrm{th}}D_{\mathrm{p}}^2 + \frac{R_{\mathrm{D}}}{R}U_2 D_{\mathrm{p}}.
    \end{equation}

    Rearrang the equation into the quadratic formula structure by
    \begin{equation}
        0 = \left(U_2 + U_{\mathrm{th}} \right)D_{\mathrm{p}}^2 + \left(\frac{R_{\mathrm{D}}}{R}U_2 - \frac{R_{\mathrm{DS,on}}}{R}U_2 -U_1\right)D_{\mathrm{p}} + \frac{R_{\mathrm{DS,on}}+R_{\mathrm{L}}}{R} U_2,
    \end{equation}
    Leads to the first solution given by
    \begin{equation}
        D_{\mathrm{P3}} = -\frac{1}{2} \frac{\frac{R_{\mathrm{D}}}{R}U_2 - \frac{R_{\mathrm{DS,on}}}{R}U_2 - U_1}{U_2 + U_{\mathrm{th}}} + \sqrt{\left(\frac{1}{2} \frac{\frac{R_{\mathrm{D}}}{R}U_2 - \frac{R_{\mathrm{DS,on}}}{R}U_2 - U_1}{U_2 + U_{\mathrm{th}}}\right)^2 - \frac{\frac{R_{\mathrm{DS,on}}+R_{\mathrm{L}}}{R}U_2}{U_2+U_{\mathrm{th}}}}
        = 0.1458,
    \end{equation}
    which results in a duty cycle of $D_3 = 0.8542$.
    The second solution is calculated in the same way as follows
    \begin{equation}
        D_{\mathrm{P3}} = -\frac{1}{2} \frac{\frac{R_{\mathrm{D}}}{R}U_2 - \frac{R_{\mathrm{DS,on}}}{R}U_2 - U_1}{U_2 + U_{\mathrm{th}}} - \sqrt{\left(\frac{1}{2} \frac{\frac{R_{\mathrm{D}}}{R}U_2 - \frac{R_{\mathrm{DS,on}}}{R}U_2 - U_1}{U_2 + U_{\mathrm{th}}}\right)^2 - \frac{\frac{R_{\mathrm{DS,on}}+R_{\mathrm{L}}}{R}U_2}{U_2+U_{\mathrm{th}}}}
        = 0.0517,
    \end{equation}
    resulting in $D = 0.9483$.

\end{solutionblock}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subtask{Beside the conduction losses, also switching losses need to be considered in practice. In \autoref{fig:TurnOffSiliconDiode} the voltage and current waveforms are visualized for the turn-off event of a diode (reverse recovery effect). Therefore, calculate the turn-off losses for a fast diode with a commutation inductivity loop of $L_{\mathrm{c}} = \SI{500}{\nano\henry}$. The peak reverse recovery current is $\hat{i}_{\mathrm{rr}} = \SI{4}{\ampere}$ and the reverse recovery time is $t_{\mathrm{rr}} = t_2 - t_0 = \SI{46.6}{\nano\second}$.}

    \input{fig/ex02/Fig_diode_switchOff.tex}

\begin{solutionblock}
    Switching losses occur when the diode voltage or current is not zero. In \autoref{fig:TurnOffSiliconDiode} the voltage and current waveforms are shown. The voltage $u_{\mathrm{D}}$ is for the interval $t_0$ until $t_1$ small and, therefore, the switching losses. At the time step $t_1$ the diode is blocking and the reverse breakdown voltage $U_{\mathrm{RB}}$ applies. Due to this much bigger value, the switching losses increases significantly, resulting that only the interval between $t_1$ and $t_2$ is responsible for the switching losses. Hence, the losses are calculated as follows
    \begin{equation}
        P_{\mathrm{l}} = \frac{1}{T} \int_{t_1}^{t_2} i_{\mathrm{rr}} U_{\mathrm{RB}} \mathrm{d}t = \frac{1}{T} U_{\mathrm{RB}} \int_{t_1}^{t_2} i_{\mathrm{rr}} \mathrm{d}t,
    \end{equation}
    with the electric charge
    \begin{equation}
        Q_2 = \int_{t_1}^{t_2} i_{\mathrm{rr}} \mathrm{d}t,
        \label{eq:chargeQ2}
    \end{equation}
    which results to the loss as:
    \begin{equation}
        P_{\mathrm{l}} = \frac{U_{\mathrm{RB}}Q_2}{T}.
    \end{equation}

    With the assumption of a linear current waveform, the derivative is replaced with the difference quotient for the time interval $t_1 - t_2$ by:
    \begin{equation}
        \Delta i_{\mathrm{D}} = \frac{\mathrm{d}i_{\mathrm{D}}(t)}{\mathrm{d}t}.
    \end{equation}
    
    The equivalent circuit diagram of the diode switch-off event is shown in \autoref{fig:DiodeSwitchOff}.
    \input{fig/ex02/sFig_diode_sw_off_esb.tex}
    The current $i_{\mathrm{D}}(t)$ is dependent on the voltage $U_2$ by:
    \begin{equation}
        \Delta i_{\mathrm{D}} \approx \frac{\mathrm{d}i_{\mathrm{D}}(t)}{\mathrm{d}t} = \frac{U_2}{L_{\mathrm{c}}} = \frac{\SI{60}{\volt}}{\SI{500}{\nano\henry}} = \SI{120}{\ampere\per\micro\second}.
    \end{equation}
    
    With the current slope $\Delta i_{\mathrm{D}}$ and the time $t_{10} = t_1 - t_0$, the maximum reverse current $\hat{i}_{\mathrm{rr}}$ is defined as
    \begin{equation}
        \Delta i_{\mathrm{D}} t_{10} = \hat{i}_{\mathrm{rr}},
    \end{equation}
    which is rearranged to calculate the time interval with:
    \begin{equation}
        t_{10} = \frac{\hat{i}_{\mathrm{rr}}}{i_{\mathrm{D}}} = \frac{\SI{4}{\ampere}}{\SI{120}{\ampere\per\micro\second}} = \SI{33.3}{\nano\second}.
    \end{equation}

    Hence, the time interval $t_{21}$ is given with:
    \begin{equation}
        t_{21} = t_{rr} - t_{10} = \SI{46.6}{\nano\second} - \SI{33.3}{\nano\second} = \SI{13.3}{\nano\second}.
    \end{equation}

    With \eqref{eq:chargeQ2} the electrical charge $Q_2$ is calculated by:
    \begin{equation}
        Q_2 = \frac{1}{2} t_{21} \hat{i}_{\mathrm{rr}} = \frac{\SI{13.3}{\nano\second}}{2} \cdot \SI{4}{\ampere} = \SI{26.6}{\nano\coulomb}.
    \end{equation}

    Reverse breakdown voltage is determined form the ECD (\autoref{fig:DiodeSwitchOff}) with the second Kirchhoff's law with:
    \begin{equation}
        U_{\mathrm{RB}} = U_2 + L_{\mathrm{c}} \frac{\mathrm{d}i_{\mathrm{rr}}(t)}{\mathrm{d}t} = \SI{60}{\volt} + \SI{500}{\nano\henry} \frac{\SI{4}{\ampere}}{\SI{13.3}{\nano\second}} = \SI{210.4}{\volt}.
        \label{eq:reverseBreakdownVoltage}
    \end{equation}

    Therefore, the turn-off switching losses are calculated as:
    \begin{equation}
        P_{\mathrm{l,D1}} = \frac{U_{\mathrm{RB}}Q_2}{T_{\mathrm{s}}} = \frac{\SI{210.4}{\volt}\cdot \SI{26.6}{\nano\coulomb}}{\frac{1}{\SI{100}{\kilo\hertz}}} = \SI{0.56}{\watt}.
    \end{equation}

\end{solutionblock}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subtask{Determine the turn-off switching losses of a normal silicon diode with a reverse recovery work $Q_{\mathrm{rr}} = \SI{16}{\micro\coulomb}$ and a rate of current rise $\frac{\mathrm{d}i_{\mathrm{rr}}}{\mathrm{d}t} = \SI{40}{\ampere\per\micro\second}$. Compare the result with the previous subtask.}

\begin{solutionblock}
    The reverse breakdown voltage is calculated with \eqref{eq:reverseBreakdownVoltage}, resulting in:
    \begin{equation}
        U_{\mathrm{RB,2}} = \SI{60}{\volt} \cdot \SI{500}{\nano\henry} \cdot \SI{40}{\ampere\per\micro\second} = \SI{80}{\volt}.
        \label{eq:RB_2}
    \end{equation}

    Furthermore, the time intervals are necessary to calculate the diode switch-off loss, which is given by  
    \begin{equation}
        T_{10} = t_1 - t_0 = \frac{\hat{i}_{\mathrm{rr}}}{\Delta i_{\mathrm{D}}}
    \end{equation}
    and
    \begin{equation}
        T_{21} = t_2 - t_1 = \frac{\hat{i}_{\mathrm{rr}}}{\Delta i_{\mathrm{rr}}}.
    \end{equation}

    With the determined time intervals, the corresponding electric charge is defined with
    \begin{equation}
        Q_1 = \frac{t_{10}}{2}\hat{i}_{\mathrm{rr}}
    \end{equation}
    and
    \begin{equation}
        Q_2 = \frac{t_{21}}{2} \hat{i}_{\mathrm{rr}}.
    \end{equation}

    With $\Delta i_{\mathrm{rr}}$ given in this subtask and with $\Delta i_{\mathrm{D}}$ from the previous subtask, the relation of the two electric charges is built to eliminate the time intervals as
    \begin{equation}
        \frac{Q_{1}}{Q_{2}} = \frac{\frac{\frac{\hat{i}_{\mathrm{rr}}}{\Delta i_{\mathrm{D}}}}{2}\hat{i}_{\mathrm{rr}}}{\frac{\frac{\hat{i}_{\mathrm{rr}}}{\Delta i_{\mathrm{rr}}}}{2}\hat{i}_{\mathrm{rr}}} 
        = \frac{\Delta i_{\mathrm{rr}}}{\Delta i_{\mathrm{D}}}
        = \frac{\SI{40}{\ampere\per\micro\second}}{\SI{120}{\ampere\per\micro\second}}
        = \frac{1}{3},
    \end{equation}
    which means, that the charge of $Q_1 = \frac{1}{3} Q_2$.
    The total electric charge is defined by
    \begin{equation}
        Q_{\mathrm{rr}} = Q_1 + Q_2 = \frac{1}{3}Q_2 + Q_2 = \frac{4}{3}Q_2,
    \end{equation}
    which is resorted to determine $Q_2$ by:
    \begin{equation}
        Q_2 = \frac{3}{4}Q_{\mathrm{rr}} = \frac{3}{4}\cdot \SI{16\cdot10^{-6}}{\ampere\second}
        = \SI{12}{\micro\coulomb}.
    \end{equation}

    As in the previous task, the main losses occur during the $T_{21}$ time interval with the electric charge $Q_{2}$. Using \eqref{eq:RB_2} from the beginning, the total switch-off loss are calculated by:
    \begin{equation}
        P_{\mathrm{l,D2}} = \frac{U_{\mathrm{RB,2}}Q_2}{T_{\mathrm{s}}}
        = \frac{\SI{80}{\volt}\cdot\SI{12}{\micro\coulomb}}{\SI{10}{\micro\second}} = \SI{96}{\watt}.
    \end{equation}

    Comparing the switch-off losses of the two diodes with
    \begin{equation}
        \frac{P_{\mathrm{l,D2}}}{P_{\mathrm{l,D1}}} = \frac{\SI{96}{\watt}}{\SI{0.59}{\watt}} = 171.4.
    \end{equation}
    which means, that the loss of the second diode are approx. 171 times higher than of the first diode. This results in a dramatic higher cooling effort for the second diode assuming the same operation area.

\end{solutionblock}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 3: Buck-Boost converter combination
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task{Buck-boost converter}
A wide input-to-output voltage range can be realized by the cascade of buck and boost converters with a common inductance.
With this topology the output voltage can be adjusted to a value which is higher or lower than the input voltage.
\par
% Schematic of Buck Boost Converter cascade
\input{./fig/ex02/Fig_BuckBoostConverterCascade}
\par
%Table of parameter values 
\input{./fig/ex02/FigTab_BuckBoostConverterCascade}

The output voltage is kept at the specified constant value by adjusting the duty cycles $D_1$ 
(of transistor  $T_1$) and $D_2$ (of transistor $T_2$) using a control system. Both transistors operate at the same switching frequency.
The ripple of the output voltage and of the current in the inductor can be ignored. The current in $L$ is continuous.
Initially, both transistors operate with the same duty cycle $D_1 = D_2 = D$ and their switching patterns are synchronized.


\subtask{Calculate the duty cycle of the transistors $T_1$ and $T_2$ depending on the voltage transformation ratio $U_\mathrm{2}/U_\mathrm{1}$.}

\begin{solutionblock}
% Solution
    For calculation of $U_\mathrm{2}$ the equations for boost converter and buck converter are to consider: 
    \begin{equation}
        U_\mathrm{2}=U_0 \frac{1}{1-D_\mathrm{2}} 
        \hspace{1cm} \mathrm{and} \hspace{1cm}  
        U_0=U_\mathrm{1} \cdot D_\mathrm{1}
    \end{equation}
    and using $D_\mathrm{1}=D_\mathrm{2}=D$ leads to
    \begin{equation}
        U_\mathrm{2}=\frac{D}{1-D} U_\mathrm{1}
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D=\frac{U_\mathrm{2}}{U_\mathrm{1}+U_\mathrm{2}}.
    \end{equation}
    Both equations leads to
    \begin{equation}
        D = \frac{\frac{U_\mathrm{2}}{U_\mathrm{1}}} {1+{\frac{U_\mathrm{2}}{U_\mathrm{1}}}}.
        \label{eq:DutyCycle}
    \end{equation}   
\end{solutionblock}

\subtask{Calculate $I_\mathrm{L}$ depending on $D$. Plot $D$ and $I_\mathrm{L}$ against $U_\mathrm{1}$ and enter the numerical values for
 $U_\mathrm{1} = \SI{320}{\volt}$, $U_\mathrm{1} = \SI{400}{\volt}$ and $U_\mathrm{1} = \SI{720}{\volt}$.}
\begin{solutionblock}
% Solution
    The current $I_\mathrm{2}$ though the load depends on the power:
    \begin{equation}
        I_\mathrm{2}=\frac{P_\mathrm{2}}{U_\mathrm{2}} = \frac{\SI{400}{\watt}}{\SI{400}{\volt}}=\SI{12.5}{\ampere}.
    \end{equation}
    The current though the inductor depends on the duty cycle and the current $I_\mathrm{2}$:
    \begin{equation}
        I_\mathrm{L}=I_\mathrm{2} \frac{1}{1-D} = I_\mathrm{2} \left(1+\frac{U_\mathrm{2}}{U_\mathrm{1}} \right).
        \label{eq:InductorCurrent}
    \end{equation}
    The current $I_\mathrm{2}$ can be calculated based on the power and with $I_\mathrm{2}$, 
    the current through the inductor is subsequently determined.
    The numerical values for the three voltages are calculated with \eqref{eq:DutyCycle} and \eqref{eq:InductorCurrent}.
    The result is displayed in \autoref{table:InductorCurrentDutyCycle}. The plots are shown in 
    \autoref{fig:DutyCycleSyncAtInputVoltage} and \autoref{fig:InductorCurrentAtInputVoltage}

    \input{./fig/ex02/sFigTab_VoltageIlDutycycle}
    \input{./fig/ex02/sFigDia_DutyCycleVSVoltage}
    \input{./fig/ex02/sFigDia_IlVSVoltage}

\end{solutionblock}
 

\vspace{2em}\par
% Explaining text for the next subtask
Both transistors should now be able to have different duty cycles. Assume that the transistors are switched on at the same time.

\subtask{Graphically represent the time profiles of the voltage at $L$ for $U_\mathrm{1}$ = $\SI{320}{\volt}$ and
 $D_1 = 0.9$ and for $U_\mathrm{1}$ = $\SI{720}{\volt}$ and $D_2 = 0.1$ for one pulse period each.}

\begin{solutionblock}
% Solution
    Case 1: Using $U_\mathrm{1}$ = $\SI{320}{\volt}$ and $D_1 = 0.9$ the duty cycle $D_2$ is obtained as
    \begin{equation}
        D_2 = 1 - D_1 \frac{U_\mathrm{1}}{U_\mathrm{2}} = 1 - 0.9 \cdot \frac{\SI{320}{\volt}}{\SI{400}{\volt}}= 0.28.
    \end{equation}

    \autoref{table:VoltageAtInductorInCase1_2} displays the inductor voltage of one period.
    \input{./fig/ex02/sFigTab_Case1a2}
    This is displayed in \autoref{fig:VoltageAtInductorInCase1}.
    \input{./fig/ex02/sFigDia_InductorVoltageCase1}

    
    Case 2: Using $U_\mathrm{1}$ = $\SI{720}{\volt}$ and $D_1 = 0.1$ the duty cycle $D_1$ is obtained as
    \begin{equation}
        D_1 = \frac{U_\mathrm{2}}{U_\mathrm{1}} \left(1 - D_2 \right)= \frac{\SI{400}{\volt}}{\SI{720}{\volt}} \cdot \left(1 - 0.1\right) = 0.5.
        \label{eq:DutyCycleD1}
    \end{equation}
    Again the inductor voltage is to calculate according \autoref{table:VoltageAtInductorInCase1_2}.
    The result is displayed in \autoref{fig:VoltageAtInductorInCase2}.

    \input{./fig/ex02/sFigDia_InductorVoltageCase2}
        
\end{solutionblock}

\subtask{Calculate the voltage transformation ratio as a function of $D_1$ and $D_2$.}
\begin{solutionblock}
% Solution
    Based on \eqref{eq:DutyCycleD1} we easily solve to the voltage transformation ratio:
    \begin{equation}
        \frac{U_\mathrm{2}}{U_\mathrm{1}} \left(1 - D_2 \right) = D_1 
        \hspace{1cm} \Rightarrow \hspace{1cm}
        \frac{U_\mathrm{2}}{U_\mathrm{1}} = \frac{D_1} {1-D_2}.
    \end{equation}
\end{solutionblock}


\subtask{Express the current $I_\mathrm{L}$ as a function of the specified operating parameters
($U_\mathrm{1}$, $U_\mathrm{2}$, $P_\mathrm{2}$) and as a function of $D_\mathrm{1}$ and $D_\mathrm{2}$.}
\begin{solutionblock}
% Solution
    The dependency of $I_\mathrm{L}$ from $I_\mathrm{2}$ and the duty cycle is leading to
    \begin{equation}
        I_\mathrm{L}=I_\mathrm{2} \frac{1}{1-D_2}= \frac{P_\mathrm{2}}{U_\mathrm{2}} \frac{1}{1-D_2}.
    \end{equation}.
\end{solutionblock}

\subtask{Are the calculated relationships valid if $T_1$ and $T_2$ do not switch synchronously or operate with
 different clock frequencies?}

\begin{solutionblock}
% Solution
    Yes, the relationsships are independent from the switching frequency and switching points.
    In \autoref{fig:VoltageAtInductorInCase1} and \autoref{fig:VoltageAtInductorInCase2} the area size above and below the zero-line are equal.
    This is kept independent of the the switching frequency and the switching points.
\end{solutionblock}

\vspace{2em}\par
% Explaining text for the next subtask
If the transistors $T_1$ and $T_2$ are switched on, a constant voltage drop $U_\mathrm{F}=\SI{2.5}{\volt}$ occurs at the transistors
 regardless of the current. All other components are considered ideal and loss-free.

\subtask{How should $D_1$ and $D_2$ be selected so that the losses of the overall system are minimal?
 The relationships calculated under subtask 3.4 and 3.5 can be used for the voltage transformation ratio and the value of $I_\mathrm{L}$.}
\begin{solutionblock}
% Solution
    The losses of the transistors are:
    \begin{equation}
        P_\mathrm{loss,T1}=D_1 U_\mathrm{F} I_\mathrm{L}=D_1 U_\mathrm{F} \frac{P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{1}{1-D_2}
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        P_\mathrm{loss,T2}=D_2 U_\mathrm{F} I_\mathrm{L}=D_2 U_\mathrm{F} \frac{P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{1}{1-D_2}.
    \end{equation}
    So the losses of both transitors can be expressed by
    \begin{equation}
        P_\mathrm{loss}=\left(D_1 +D_2\right) U_\mathrm{F} \frac{P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{1}{1-D_2}
    \end{equation}
    and with
    \begin{equation}
        D_1 =\frac{U_\mathrm{1}}{U_\mathrm{2}} \left(1 - D_2 \right) 
        \hspace{1cm} \Rightarrow \hspace{1cm}
        P_\mathrm{loss}=\left(\frac{U_\mathrm{1}}{U_\mathrm{2}} \left(1 - D_2 \right)+D_2\right) U_\mathrm{F} \frac{P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{1}{1-D_2}.
    \end{equation}
    This leads to
    \begin{equation}
        P_\mathrm{loss}=P_\mathrm{2} U_\mathrm{F} \left(\frac{1}{U_\mathrm{1}} + 
        \frac{1}{U_\mathrm{2}} \cdot \frac{D_2}{1-D_2}\right).
        \label{eq:ploss}
    \end{equation}
    The losses minimum is determined by differentiating with respect to the duty cycle $D_2$.    
    \begin{equation}
        P_\mathrm{loss}=f(D_2)
        \hspace{1cm} \Rightarrow \hspace{1cm}
        \frac{\mathrm{d}}{\mathrm{d}D_2} f(D_2)= \frac{1}{\left(1 - D_2 \right)^2}=0.
        \label{eq:derivateDutycyle}
    \end{equation}

    There is no solution in the real number space for \eqref{eq:derivateDutycyle}.
    According \eqref{eq:ploss} the power loss decreases, when $\frac{D_2}{1-D_2}$ decrease.
    The following can be conclude from the result:
    \begin{itemize}
        \item Set $D_2$ as small as possible.
        \item Activate $T_2$ only for boost mode.
        \item Set $D_1$ as big as as possible.
    \end{itemize}     
\end{solutionblock}

\subtask{Plot $D_\mathrm{1}$ and $D_\mathrm{2}$ and the efficiency over $U_\mathrm{1}$ and give numerical values
 for $U_\mathrm{1} = \SI{320}{\volt}$, $U_\mathrm{1} = \SI{400}{\volt}$ and $U_\mathrm{1} = \SI{720}{\volt}$.}
\begin{solutionblock}
% Solution
    The power loss is to calculate with \eqref{eq:ploss} for the 3 different voltages.
    The efficiency is obtained by applying
    \begin{equation}
        \eta = \frac{P_\mathrm{2}}{P_\mathrm{loss}+P_\mathrm{2}}.
    \end{equation}
    Using both equations lead to the results displayed in \autoref{table:PowerlossDutyCycleEfficiencyOpt} 
    and plotted in \autoref{fig:DutyCycleOptAtInputVoltage}.

    \input{./fig/ex02/sFigTab_EfficiencyOpt}
    \input{./fig/ex02/sFigDia_DutyCycleVSVoltageOpt}
    
\end{solutionblock}

\subtask{Calculate the efficiency for the three operating points in subtask 3.2.}

\begin{solutionblock}
% Solution
    Again \eqref{eq:ploss} is used with the condition $D_1$=$D_2$=$D$. This leads to
    \begin{equation}
        P_\mathrm{loss}=2D U_\mathrm{F} I_\mathrm{L} = \frac{U_\mathrm{f} P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{2D}{1-D}.
    \end{equation}
    If you enter the 3 operation voltages you get the results according \autoref{table:PowerlossDutyCycleEfficiencySync}.
    \input{./fig/ex02/sFigTab_EfficiencySync}
    
\end{solutionblock}

\subtask{How high is the maximum efficiency gain and at which operating point does it occur? Give an explanation
 for the observed finding.}

\begin{solutionblock}
% Solution
    The efficiency gain is calculated by $\Delta \eta$=$\eta_\mathrm{opt}$-$\eta_\mathrm{sync}$.
    You get following result:

    \input{./fig/ex02/sFigTab_EfficiencyGain}
    
    The maximum efficiency gain is at $U_\mathrm{1}=\SI{400}{\volt}$.
    It looks like the efficiency gain is higher within boost mode, but why is the highest efficiency gain at $\SI{400}{\volt}$?
    Let's consider the power loss at boost mode for the two cases. The power loss needs to be expressed by a function of the voltages:

    \begin{equation}
        P_\mathrm{loss}=D_1 U_\mathrm{F} I_\mathrm{L} + D_2 U_\mathrm{F} I_\mathrm{L}.
        \label{eq:ploss2}
    \end{equation}
    Considering the optimal efficiency the $D_1=1$ and $D_2=f(U_\mathrm{2})$ for $\SI{320}{\volt} \leq U_\mathrm{2} \leq \SI{400}{\volt}$ 
    (boost mode) and $D_1=0$ and $D_1=f(U_\mathrm{2})$ for $\SI{400}{\volt} \le U_\mathrm{2} \leq \SI{720}{\volt}$ (buck mode). \\
    For $\SI{320}{\volt} \leq U_\mathrm{2} \leq \SI{400}{\volt}$ (boost mode) 
    \begin{equation}
        I_\mathrm{L}=\frac{P_\mathrm{2}}{U_\mathrm{1}} 
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D_1=1
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D_2=1-\frac{U_\mathrm{1}}{U_\mathrm{2}} 
    \end{equation}
    leads to
    \begin{equation}
        P_\mathrm{loss,opt}=\frac{2 P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{1}} - \frac{P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{2}}.
        \label{eq:Plossoptboost}
    \end{equation}
    For $\SI{400}{\volt} \le U_\mathrm{2} \leq \SI{720}{\volt}$ (buck mode)
    \begin{equation}
        I_\mathrm{L}=\frac{P_\mathrm{2}}{U_\mathrm{1}} 
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D_1=\frac{U_\mathrm{1}}{U_\mathrm{2}}
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D_2=0 
    \end{equation}
    leads to
    \begin{equation}
        P_\mathrm{loss,opt}=\frac{P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{1}}.
        \label{eq:Plossoptbuck}
    \end{equation}

    For the synchronous operation mode following is valid:
    \begin{equation}
        I_\mathrm{L}=\frac{P_\mathrm{2}}{U_\mathrm{2}} \cdot \frac{1}{1-D}  
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D_1=D_2=D
        \hspace{1cm} \mathrm{and} \hspace{1cm}
        D=\frac{U_\mathrm{2}}{U_\mathrm{1}+U_\mathrm{2}}.
    \end{equation}
    Using \eqref{eq:ploss2} leads to:
    \begin{equation}
        P_\mathrm{loss,sync}=\frac{P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{1}} + \frac{P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{1}}=\frac{2 P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{1}}.
        \label{eq:Plosssync}
    \end{equation}

    The efficiency can be expressed by 
    \begin{equation}
        \eta = \frac{P_\mathrm{2}}{P_\mathrm{loss}+P_\mathrm{2}}=\frac{1}{1+\frac{P_\mathrm{loss}}{P_\mathrm{2}}}.
        \label{eq:efficiencysyncopt}
    \end{equation}
    Using \eqref{eq:Plossoptboost} and \eqref{eq:Plossoptbuck} in \eqref{eq:efficiencysyncopt} results in:
    \begin{equation}
        \eta_\mathrm{opt,boost} = \frac{1}{1+U_\mathrm{F} \left(\frac{2}{U_\mathrm{1}}-\frac{1}{U_\mathrm{2}}\right)}
        \hspace{1cm} \mathrm{and} \hspace{1cm}        
        \eta_\mathrm{opt,buck} = \frac{1}{1+\frac{U_\mathrm{F}}{U_\mathrm{1}}}.
        \label{eq:efficiencyopt}
    \end{equation}
    Using \eqref{eq:Plosssync} in \eqref{eq:efficiencysyncopt} results in:
    \begin{equation}
        \eta_\mathrm{sync} = \frac{1}{1+U_\mathrm{F} \frac{2}{U_\mathrm{1}}}.
        \label{eq:efficiencysync}
    \end{equation}

    The efficiency gain is $\Delta \eta=\eta_\mathrm{opt}-\eta_\mathrm{sync}$:
    
    \begin{equation}
        \Delta \eta_\mathrm{boost}= \frac{\frac{U_\mathrm{F}}{U_\mathrm{2}}}{\left(1+ \frac{2 U_\mathrm{F}}{U_\mathrm{1}}-\frac{U_\mathrm{F}}{U_\mathrm{2}} \right) \left(1+\frac{2 U_\mathrm{F}}{U_\mathrm{1}}\right)}.
        \label{eq:efficiencygainboost}
    \end{equation}

    \begin{equation}
        \Delta \eta_\mathrm{buck}= \frac{\frac{U_\mathrm{F}}{U_\mathrm{1}}}{\left(1+ \frac{2 U_\mathrm{F}}{U_\mathrm{1}}\right) \left(1+\frac{ U_\mathrm{F}}{U_\mathrm{1}}\right)}.
        \label{eq:efficiencygainbuck}
    \end{equation}

    The two efficiencies are calculated with \eqref{eq:efficiencyopt},\eqref{eq:efficiencysync}  and displayed in \autoref{fig:EfficiencyAtInputVoltage}.
    \input{./fig/ex02/sFigDia_EfficiencyVSVoltage}


    Conclusions:
    \begin{itemize}
        \item \eqref{eq:efficiencysync} and \eqref{eq:efficiencyopt} shows, that $\eta_\mathrm{opt,boost}$ 
        and $\eta_\mathrm{sync}$ differ only by the constant factor $\frac{U_\mathrm{F}}{U_\mathrm{2}}$ 
        which has a relatively greater impact on efficiency at higher $U_\mathrm{1}$.
        \item \eqref{eq:efficiencysync} and \eqref{eq:efficiencyopt} shows, that $\eta_\mathrm{opt,buck}$ 
        and $\eta_\mathrm{sync}$ differ in the coefficient of $\frac{U_\mathrm{F}}{U_\mathrm{1}}$ in the denominator. 
        This cause that the difference decrease with increasing $U_\mathrm{1}$. 
        \item The difference between the power losses of $P_\mathrm{loss,opt}$ and $P_\mathrm{loss,sync}$ in boost mode is the constant factor 
        $\frac{P_\mathrm{2} U_\mathrm{F}}{U_\mathrm{2}}$
        which has a proportionally greater effect on the efficiency with smaller $U_\mathrm{2}$ power losses (here larger $U_\mathrm{1}$).
        \item The highest efficiency gain is obtained at $U_\mathrm{1}=\SI{400}{\volt}$ since the input and output voltage are equal allowing to not switch at all in the optimized pattern mode (compared to $D_1=D_2=0.5$ in standard synchronous mode leading to unnecessary switching).
    \end{itemize}      

\end{solutionblock}
