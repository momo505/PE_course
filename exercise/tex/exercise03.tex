%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Begin exercise %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ex{Combined step-up / step-down converters}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 1: Inverting buck-boost converter %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\task {Inverting buck-boost converter}
An inverting buck-boost converter (see \autoref{fig:Inverting buck-boost converter}) is used to generate the negative supply voltage of a control electronic unit. The input voltage is specified as $U_\mathrm{1}=\SI{18}{\volt}$, the output voltage is regulated to $U_\mathrm{2}=\SI{12}{\volt}$. The output power can vary in the range $P_\mathrm{2} = \SI{2}{\watt} \, \dots \, \SI{15}{\watt}$.

\input{./fig/ex03/Fig_inverseConverter.tex}

\subtask{The system should operate at boundary conduction mode (BCM)   throughout the entire output power range. How should the inductance be selected so that the switching frequency is always above the hearing threshold $f_\mathrm{s}=\SI{20}{\kilo\hertz}$?}

\begin{solutionblock}
The $\Delta$ is an approximation of the total differential using a difference equation with the differences $\Delta$. This results in the component differential equations becoming average value equations.
During the transistor on time, the input voltage is equal to the inductor voltage and defined as:
\begin{equation}
    U_{\mathrm{1}} = \overline u_{\mathrm{L}} = L \frac{\Delta i_{\mathrm{L}} }{\Delta t}. 
\end{equation}
    With voltages $U_1$ and $U_2$ given in the task, the duty cycle is calculated as:
\begin{equation}
    D = \frac{U_\mathrm{2}}{U_\mathrm{1}+U_\mathrm{2}} = \frac{\SI{12}{\volt}}{\SI{18}{\volt}+\SI{12}{\volt}} = 0.4.
\end{equation}
During the on phase of the transistor, the total energy for one period (on and off phase) must be stored in the inductor. Therefore, the average power and the corresponding inductor current increases with the inverse value of the duty cycle. Hence, the average inductor current is given with:
\begin{equation}
    \overline{i}_\mathrm{L} = \frac{P_\mathrm{2}}{U_\mathrm{2}} \frac{1}{D}=\frac{\SI{15}{\watt}}{\SI{12}{\volt}}\frac{5}{3}=\SI{2.083}{\ampere}.
\end{equation}
With BCM the maximum inductor current, i.e., the peak-to-peak ripple, is defined as:
\begin{equation}
    \Delta i_{\mathrm{L}} = 2 \overline{i}_\mathrm{L} = \SI{4.16}{\ampere}.
\end{equation}
Here, $\Delta t$ can also be expressed as:
\begin{equation}
    \Delta t = \frac{D}{f_\mathrm{s}}.
\end{equation}
Therefore, the inductance can be determined using the following equation:
\begin{equation}
    L = \frac{\Delta t  \overline u_{\mathrm{L}}}{\Delta i_{\mathrm{L}}}= \frac{D \overline u_{\mathrm{L}}}{f_\mathrm{s}\Delta i_{\mathrm{L}}}= \frac{D U_{\mathrm{1}}}{f_\mathrm{s}\Delta i_{\mathrm{L}}} = \frac{0.4 \cdot \SI{18}{\volt}}{\SI{20}{\kilo\hertz}\cdot \SI{4.16}{\ampere }} = \SI{86.4}{\micro\henry}.
\end{equation}

\end{solutionblock}
\subtask{In what value range does the switching frequency $f_\mathrm{s}$ vary considering the inductance choice from the previous subtask and the given output power range?}

 \begin{solutionblock}
     The inductance equation is used again for this subtask:
     \begin{equation}
        L = \frac{\Delta t \overline u_{\mathrm{L}}}{\Delta i_{\mathrm{L}}}= \frac{D \overline u_{\mathrm{L}}}{f_\mathrm{s}\Delta i_{\mathrm{L}}}.
     \end{equation}
     This equation can be rewritten to determine the frequency as follows:
     \begin{equation}
        f_\mathrm{s} = \frac{DU_{\mathrm{1}}}{L\Delta i_{\mathrm{L}}}. \label{eq:equation switching frequencies ex03}
     \end{equation}
      
As the output power is specified as a value range, the highest and lowest values can be used. The lowest and highest current should be determined from these two values, from which the value range of the frequency $f_\mathrm{s}$ can then be determined.
The average inductor current is calculated as:
     \begin{equation}
        \overline{i}_\mathrm{L}(P_\mathrm{2}=\SI{2}{\watt})= \frac{P_\mathrm{2}}{U_\mathrm{2}}\frac{1}{D}=\frac{\SI{2}{\watt}}{\SI{12}{\volt}}\frac{5}{3}=\SI{0.278}{\ampere},
     \end{equation}
     \begin{equation}
        \overline{i}_\mathrm{L}(P_\mathrm{2}=\SI{15}{\watt})= \frac{P_\mathrm{2}}{U_\mathrm{2}}\frac{1}{D}=\frac{\SI{15}{\watt}}{\SI{12}{\volt}}\frac{5}{3}=\SI{2.0833}{\ampere}.
     \end{equation}
     With \eqref{eq:equation switching frequencies ex03} the resulting switching frequencies are:
     \begin{equation}
        f_\mathrm{s}(P_\mathrm{2}=\SI{2}{\watt})=\frac{0.4\cdot\SI{18}{\volt}}{\SI{86.4}{\micro\henry}\cdot 2\cdot \SI{0.278}{\ampere}}=\SI{150}{\kilo \hertz},
     \end{equation}
     \begin{equation}
        f_\mathrm{s}(P_\mathrm{2}=\SI{15}{\watt})=\frac{0.4\cdot\SI{18}{\volt}}{\SI{86.4}{\micro\henry}\cdot 2\cdot \SI{2.0833}{\ampere}}=\SI{20}{\kilo \hertz}.
     \end{equation}
     The switching frequency $f_\mathrm{s}$ varies in the range from $\SI{20}{\kilo \hertz} \, \dots \, \SI{150}{\kilo \hertz}$ for the specified output power range in the task.
 \end{solutionblock}

 \subtask{What is the peak value $\hat i_1=\max\{i_1(t)\}$ of the transistor current?}
 \begin{solutionblock}
    As the current through the transistor is the current $i_1$, their maximum values are the same. Since the BCM is considered in this circuit, the maximum current is the peak ripple current, which corresponds to the value of $\SI{4.16}{\ampere}$.
 \end{solutionblock}

 \subtask{How does the duty cycle $D$ change with the output power? Calculate the duty cycle values and the transistor switch-on times $T_\mathrm{on} = D T_\mathrm{s}$ for minimum and maximum output power.}
 \begin{solutionblock}
 The switching period is the inverse of the switching frequency: 
 \begin{equation}
    T_\mathrm{s} = \frac{1}{f_\mathrm{s}}. \label{switching frequency}
 \end{equation}
 The previously obtained maximum and minimum switching frequencies lead to:
 \begin{equation}
    T_\mathrm{s}(P_\mathrm{2}=\SI{2}{\watt}) = \frac{1}{\SI{150}{\kilo \hertz}}= \SI{6.67}{\micro \s},
 \end{equation}
 \begin{equation}
    T_\mathrm{s}(P_\mathrm{2}=\SI{15}{\watt}) = \frac{1}{\SI{20}{\kilo \hertz}}= \SI{50}{\micro \s}.
 \end{equation}
 The transistor switch-on times can be determined using 
 \begin{equation}
    T_\mathrm{on} = D T_\mathrm{s} \label{absolut value switch-on-times}
 \end{equation}
 leading to:
 \begin{equation}
    T_\mathrm{on}(P_\mathrm{2}=\SI{2}{\watt}) = 0.4 \cdot \SI{6.67}{\micro \s} = \SI{2.67}{\micro \s},
 \end{equation}
 \begin{equation}
    T_\mathrm{on}(P_\mathrm{2}=\SI{15}{\watt}) = 0.4 \cdot \SI{50}{\micro \s}= \SI{20}{\micro \s}.
 \end{equation}
 \end{solutionblock}

 \subtask{Sketch the course of the inductor current $i_\mathrm{L}(t)$  for minimum and maximum output power.}
\begin{solutionblock}
    The solution sketch is depicted in \autoref{fig:InductorCurrentEx03}.
    \input{fig/ex03/Fig_courseILminmaxOutputPower.tex}   
\end{solutionblock}
    
\subtask{At which operating point does the maximum output voltage ripple $\Delta u_\mathrm{2}$ occur (assumption: the load draws a constant current)?}
 
\begin{solutionblock}
    The capacitor current is given by
    \begin{equation}
        i_{\mathrm{C}}(t) = i_{\mathrm{L}}(t)-I_{\mathrm{2}},
    \end{equation}
    with the assumption of a constant load current $I_2$.
    The voltage equation of the capacitor is defined as
    \begin{equation}
        i_{\mathrm{C}}(t) = C\frac{\mathrm{d}u_{\mathrm{C}}(t)}{\mathrm{d}t},
    \end{equation}
    which is rearranged into
    \begin{equation}
        u_{\mathrm{C}}(t) = \frac{1}{C} \int i_{\mathrm{C}}(t),
    \end{equation}
    showing that the voltage ripple depends on the capacitor current, which is larger a the second operating point ($P_2 = \SI{15}{\watt}$, \autoref{fig:InductorCurrentEx03}), leading to the highest voltage ripple.
\end{solutionblock}

\subtask{How high should the output capacitance be selected to ensure $\Delta u_\mathrm{2} < 0.02 \cdot U_\mathrm{2}?$}

\begin{solutionblock}
    The output capacitor $C_2$ is located parallel to the output voltage $U_2$, therefore, the maximum voltage ripple is calculated according to the task description with:
    \begin{equation}
        \Delta u_2 = \Delta u_{\mathrm{C}} = 0.02 U_2 = 0.02 \cdot \SI{12}{\volt} = \SI{0.24}{\volt}.
    \end{equation}

    The relationship between the voltage ripple and the capacitance is identical to the step-up converter, which is defined as:
    \begin{equation}
        \Delta u_{\mathrm{C}} = \frac{I_2}{C} D T_{\mathrm{s}}.
    \end{equation}
    Considering the maximum power ($P_2 = \SI{15}{\watt}$) results into:
    \begin{equation}
        C_2 = \frac{I_{\mathrm{2}}(P_\mathrm{2}=\SI{15}{\watt}) D T_{\mathrm{s}}(P_\mathrm{2}=\SI{15}{\watt})}{\Delta u_{\mathrm{C}}}
        = \frac{\SI{1.25}{\ampere} \cdot 0.4 \cdot \SI{50}{\micro\second}}{\SI{0.24}{\volt}}
        = \SI{104}{\micro\farad}. 
    \end{equation}

\end{solutionblock}

\subtask{What is the maximum effective value $i_\mathrm{C,RMS}$ of the output capacitor current?}

\begin{solutionblock}

    The capacitor RMS current is defined as follows
    \begin{equation}
        i_{\mathrm{C,RMS}} = \sqrt{\frac{1}{T_{\mathrm{s}}} \int_{0}^{T_{\mathrm{s}}}i_{\mathrm{C}}^2(t)\mathrm{d}t},
    \end{equation}
    with the capacitor current for the inverting buck-boost converter being:
    \begin{equation}
        {i_\mathrm{C}(t) = \begin{cases}
            \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2(t-kT_\mathrm{s})}{2T_\mathrm{off}}, & t\in [k T_\mathrm{s}, k T_\mathrm{s} + T_\mathrm{off}],\\
            -I_2, & t\in [k T_\mathrm{s}+ T_\mathrm{off}, (k+1) T_\mathrm{s}].
        \end{cases}}
    \end{equation}
    For $k$ = 0 the equation results into
    \begin{equation}
        i_{\mathrm{C,RMS}} = \sqrt{\frac{1}{T_{\mathrm{s}}} \int_{0}^{T_{\mathrm{off}}} \underbrace{\left( \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2t}{2T_\mathrm{off}}\right)^2}_{a} \mathrm{d}t+ \frac{1}{T_{\mathrm{s}}}\int_{T_{\mathrm{off}}}^{T_{\mathrm{s}}} \left(-I_2 \right)^2 \mathrm{d}t},
    \end{equation}
    where the variable $a$ is utilized for a shorter description in the following. This first part is solved as:
    \begin{align}
        \begin{split}
        \int_{0}^{T_{\mathrm{off}}} a \mathrm{d}t &= \int_{0}^{T_{\mathrm{off}}} \left( \frac{D}{1-D}I_2 + \Delta i_\mathrm{L} \frac{T_\mathrm{off}-2t}{2T_\mathrm{off}}\right)^2 \mathrm{d}t \\
        &= \int_{0}^{T_{\mathrm{off}}} \frac{D^2}{\left(D-1\right)^2}I_2^2 + \frac{D}{(1-D)}I_2 \Delta i_{\mathrm{L}} - 2 \frac{D}{(1-D)} I_2 \Delta i_{\mathrm{L}} \frac{t}{T_{\mathrm{off}}} \\ &\hspace{5mm} + \frac{1}{4} \Delta i_{\mathrm{L}}^2 - \Delta i_{\mathrm{L}}^2 \frac{t}{T_{\mathrm{off}}} + \Delta i_{\mathrm{L}}^2 \frac{t^2}{T_{\mathrm{off}}^2} \mathrm{d}t \\
        & = \left[\frac{D^2}{\left(1-D\right)^2} I_2^2 t + \frac{D}{(1-D)}I_2 \Delta i_{\mathrm{L}} t - \frac{D}{(1-D)} I_2 i_{\mathrm{L}} \frac{t^2}{T_{\mathrm{off}}} \right. \\ & \left. \hspace{5mm} + \frac{1}{4}\Delta i_{\mathrm{L}}^2 t - \frac{1}{2} \Delta i_{\mathrm{L}}^2 \frac{t^2}{T_{\mathrm{off}}} + \frac{1}{3 }\Delta i_{\mathrm{L}}^2 \frac{t^3}{T_{\mathrm{off}}^2} \right]_{0}^{T_{\mathrm{off}}}.
        \end{split}
    \end{align}
    Applying the limits of the integral and rearranging the expression results into:
    \begin{align}
        \begin{split}
        \int_{0}^{T_{\mathrm{off}}} a \mathrm{d}t &= \left[\frac{D^2}{\left(1-D\right)^2}I_2^2 + \frac{1}{12} \Delta i_{\mathrm{L}}^2 \right] T_{\mathrm{off}} - 0 \\
        &= \left[\frac{0.4^2}{\left(1-0.4\right)^2} \cdot \left(\SI{1.25}{\ampere}\right)^2 + \frac{1}{12}\cdot \left(\SI{4.16}{\ampere}\right)^2 \right] \cdot \SI{30}{\micro\second} = \SI{64.1}{\ampere^2\micro\second}.
        \end{split}
    \end{align}
    The calculation of the second part (transistor is open) is given by:
    \begin{equation}
        \int_{T_{\mathrm{off}}}^{T_{\mathrm{s}}} \left(-I_2 \right)^2 \mathrm{d}t = \left[I_2^2 t \right]_{T_{\mathrm{off}}}^{T_{\mathrm{s}}} = I_2^2 \left(T_{\mathrm{s}} - T_{\mathrm{off}}\right) = (\SI{1.25}{\ampere})^2 \cdot (\SI{50}{\micro\second} - \SI{30}{\micro\second}) = \SI{31.3}{\ampere^2\micro\second}.
    \end{equation}
    Hence, the capacitor RMS current is calculated with:
    \begin{equation}
        i_{\mathrm{C,RMS}} = \sqrt{\frac{1}{\SI{50}{\micro\second}} \left(\SI{64.1}{\ampere^2\micro\second} + \SI{31.3}{\ampere^2\micro\second}\right)} = \SI{1.38}{\ampere}.
    \end{equation}
\end{solutionblock}

 \subtask{Sketch the curves of the voltage $u_\mathrm{T}(t)$ at the power transistor and the current $i_\mathrm{D}(t)$ in the output diode for $P_\mathrm{2}=\SI{2}{\watt}$. What is the maximum blocking voltage of the transistor?}

 \begin{solutionblock}
    The input voltage for an activated transistor is given with
    \begin{equation}
        U_1 = u_{\mathrm{T}} + u_{\mathrm{L}},
    \end{equation}
    which is rearranged into:
    \begin{equation}
        u_{\mathrm{T}} = U_1 - u_{\mathrm{L}}.
        \label{eq:uT}
    \end{equation}

    During the off time of the transistor, the inductance voltage is defined as
    \begin{equation}
        u_{\mathrm{L}} = -U_2 - u_{\mathrm{D}},
        \label{eq:U2}
    \end{equation}
    where the diode voltage is assumed to be zero during the conduction phase.
    Hence, the maximum blocking voltage of the transistor is calculated with \eqref{eq:uT} and \eqref{eq:U2}, which results in:
    \begin{equation}
        u_{\mathrm{T}} = U_1 - (-U_2)
        = U_1 + U_2 = \SI{18}{\volt} + \SI{12}{\volt} = \SI{30}{\volt}.
    \end{equation}

    The diode current and the blocking voltage of the transistor is shown in \autoref{fig:inverseCon_voltage_current}.
    \input{fig/ex03/sFigDia_Inverse.tex}
 \end{solutionblock}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Task 2: Boost-Buck converter and SEPIC topology
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\task {Boost-buck converter and SEPIC topology}

The supply of a plasma coating system is realized by a boost converter followed by a buck converter according \autoref{fig:ex03_boost_buck_converter} (with common capacitance).
The converter is connected to a voltage $U_\mathrm{1}$ and provides a variable output voltage $U_\mathrm{2}$. The parameters are displayed in \autoref{table:ParametersOfBoostBuckConverter}.
\vspace{2em}\par

\par
% Schematic of Buck Boost Converter cascade
\input{./fig/ex03/Fig_BoostBuckConverter}
\par
%Table of parameter values 
\input{./fig/ex03/FigTab_BoostBuckConverter}

The output voltage is set to the specified value by adjusting the duty cycles $D_\mathrm{1}$ (of transistor $T_\mathrm{1}$) 
and $D_\mathrm{2}$ (of transistor $T_\mathrm{2}$) using a control system. Both transistors operate at the same switching frequency. 
The switching frequency fluctuation of the intermediate circuit voltage and the currents in the inductors can be neglected unless otherwise stated. 
The currents in $L_\mathrm{1}$ and $L_\mathrm{2}$ show a continuous course. Both transistors are operated with the 
same duty cycle $D_\mathrm{1}$ = $D_\mathrm{2}$ = $D$.

\subtask{Calculate the duty cycle $D$ range to achieve the stated output voltage $U_\mathrm{2}$ range.}

\begin{solutionblock}
    % Solution
    For the boost-buck converter the voltage transfer ratio delivers:
    \begin{equation}
        \frac{U_\mathrm{2}}{U_\mathrm{1}} = \frac{D} {1-D}
        \quad \Leftrightarrow \quad
        D = \frac{\frac{U_\mathrm{2}}{U_\mathrm{1}}} {1+{\frac{U_\mathrm{2}}{U_\mathrm{1}}}}.
        \label{eq:DutyCycleEx03}
    \end{equation}
    In case of $U_\mathrm{2}$ = $\SI{285}{\volt}$, the duty cycle results in
    \begin{equation}
       D=\frac{\frac{\SI{285}{\volt}}{\SI{380}{\volt}}} {1+{\frac{\SI{285}{\volt}}{\SI{380}{\volt}}}} = 0.429.
    \end{equation}
\end{solutionblock}


\subtask{Which intermediate circuit voltage $U_\mathrm{0}$ results depending on $U_\mathrm{2}$?}

\begin{solutionblock}
    % Solution
    The first part is the boost converter part. For the output voltage 
    of $\SI{285}{\volt}$, the intermediate circuit voltage $U_\mathrm{0}$ is calculated as
    \begin{equation}
        U_\mathrm{0}=U_\mathrm{1} \frac{1}{1-D} 
        =
        \SI{380}{\volt} \frac{1}{1-0.429} = \SI{665}{\volt}.
        \label{eq:DCLinkEx03}        
    \end{equation}
\end{solutionblock}


\subtask{Plot $D$ and $U_\mathrm{0}$ against $U_\mathrm{2}$ and calculate the numerical values for $U_\mathrm{2}=\SI{285}{\volt}$, $U_\mathrm{2}=\SI{380}{\volt}$ and $U_\mathrm{2}=\SI{450}{\volt}$.}

\begin{solutionblock}
    % Solution
    Here, \eqref{eq:DutyCycleEx03} and \eqref{eq:DCLinkEx03} are used to calculate results summarized in \autoref{table:DutyCycleDCLinkVoltageAtOutputVoltage} 
    and displayed in \autoref{fig:DCLinkVoltageAtOutputVoltage} and \autoref{fig:DutyCycleAtOutputVoltage}.

    %Result table
    \input{./fig/ex03/sFigTab_DCLinkVoltageDutycycleE3T2}
    %Plot of DCLinkVoltage
    \input{./fig/ex03/sFigDia_DCLinkVSUoutE3T2}
    %Plot of duty cycle
    \input{./fig/ex03/sFigDia_DutyCycleVSUoutE3T2}

\end{solutionblock}

\subtask{What blocking voltage ratings must the transistors $T_\mathrm{1}$ and $T_\mathrm{2}$ and the diodes $D_1$ and
$D_2$ have?}

\begin{solutionblock}
    % Solution
    Based on the schematic from \autoref{fig:ex03_boost_buck_converter}, following voltage ratings of the semiconductor components can be derived:
    \begin{itemize}
        \item Reverse voltage across $D_1$: In case of $T_1$ is active, the potential at the T$T_1$'s drain is pulled down. 
              The diode $D_1$ hat to block $U_0$.
        \item Block voltage across $T_1$: In case of $T_1$ is inactive, the current of $i_\mathrm{L1}$ load the capacitor $C$ via diode $D_1$. 
              The voltage across the ideal diode in forward direction is \SI{0}{\volt}, so that the voltage $U_0$ is applied to transistor T1.
        \item Reverse voltage across $D_2$: In case of $T_2$ is active, the voltage $U_0$ of capacitor $C$ is applied to $D_2$.
        \item Block voltage across $T_2$: In case of $T_2$ is inactive, the current $i_\mathrm{L2}$ flows through $D_1$. 
              The forward voltage of the ideal diode is \SI{0}{\volt}, so that $U_0$ is applied to $T_2$.
    \end{itemize}     
    The minimum blocking voltage of the component needs to be higher than $U_\mathrm{0}$.
\end{solutionblock}

\vspace{2em}\par
The converter operation continues with $D_\mathrm{1}$ = $D_\mathrm{2}$ = $D$. The input and output inductances 
have the same value $L_\mathrm{1}$ = $L_\mathrm{2}$ = $L$ = $\SI{0.5}{m\henry}$.

\subtask{Derive the input and output current ripple $\Delta i_\mathrm{L_1}$ and $\Delta i_\mathrm{L_2}$ depending on the duty cycle.}

\begin{solutionblock}
    % Solution
    The current ripple depends on the duty cycle, switching period and inductor voltage.
    For the boost converter stage:
    \begin{equation}
        \Delta i_\mathrm{L1}=\frac{U_\mathrm{1}D}{f_\mathrm{s}L}
        \label{eq:Boostripple}
    \end{equation}
    results while the buck converter stage's current ripple is:
    \begin{equation}
        \Delta i_\mathrm{L2}=\frac{\left(U_\mathrm{0}-U_\mathrm{2}\right)D}{f_\mathrm{s}L}.
        \label{eq:Buckripple}
    \end{equation}
\end{solutionblock}

\subtask{To what minimum value can the output power be reduced while still ensuring 
continuous operation across the entire output voltage range 
(i.e., continuous current flow in $L_\mathrm{1}$  and $L_\mathrm{2}$)?}

\begin{solutionblock}
    % Solution
    For the boost stage the power is the product of output voltage
     $U_\mathrm{0}$ and average current calculated by using \eqref{eq:Boostripple}:
    \begin{equation}
        P_\mathrm{lim,boost}=U_\mathrm{0}\frac{\Delta i_\mathrm{L1}}{2}D.
        \label{eq:PowerBoostripple}
    \end{equation}
    For the buck stage the power is the product of output voltage
    $U_\mathrm{2}$ and average current calculated by using \eqref{eq:Buckripple}:
    \begin{equation}
        P_\mathrm{lim,buck}=U_\mathrm{2}\frac{\Delta i_\mathrm{L2}}{2}.
        \label{eq:PowerBuckripple}
    \end{equation}
    Entering the relevant values in \eqref{eq:PowerBoostripple} and \eqref{eq:PowerBuckripple} leads to \autoref{table:PowerminInputOutputStage}.
    %Solution table Minimal Power 
    \input{./fig/ex03/sFigTab_PowerminInputOutputStage}
    The minimal power, which ensuring continuous operation across the entire output voltage range
    yields  $\SI{1854}{\watt}$.
\end{solutionblock}

\subtask{At which value of the output voltage range is this limit reached first on the input side and at which value is it reached first on the output side?}
\begin{solutionblock}
    % Solution
    As displayed in \autoref{table:PowerminInputOutputStage} the minimal power limit is caused by the 
    boost-stage (input side) for output voltage less than \SI{380}{\volt}. For output voltages greater than \SI{380}{\volt} 
    the buck-stage (output side) causes the minimal power limit for continuous conduction mode.
\end{solutionblock}

\vspace{2em}\par
For comparison reasons, the single ended primary inductance converter (SEPIC) in \autoref{fig:ex03_SEPIC} shall be considered under similar conditions as an alternative circuit.

% Schematic of Buck Boost Converter cascade
\input{./fig/ex03/Fig_SepicConverter}

\subtask{What blocking voltage ratings must the transistors $T_\mathrm{1}$ and the diode $D$ have?}
\begin{solutionblock}
    % Solution
    For the SEPIC topology the voltage at the transistor blocking voltage is calculated by the sum of 
    $U_\mathrm{c}$ and $U_\mathrm{2}$.
    \begin{equation}
        U_\mathrm{T,block}=U_\mathrm{C}+U_\mathrm{2}.
    \end{equation}
    Using \eqref{eq:PowerL1ripplesepic}, which reflects the voltage balance during a switching period 
    of inductor $L_1$ as
    \begin{equation}
        DU_\mathrm{1}+\left(1-D\right)\left(U_\mathrm{1}-U_\mathrm{2}-U_\mathrm{C}\right)=0
    \end{equation}
    the voltage $U_\mathrm{C}$ is obtained by
    \begin{equation}
        U_\mathrm{C}=\frac{U_\mathrm{1}}{1-D}-U_\mathrm{2}.
    \end{equation}
    The substitution of $U_\mathrm{1}$ by $U_\mathrm{2}$ leads to
    \begin{equation}
        U_\mathrm{C}=U_\mathrm{2}\frac{\left(1-D\right)}{D}\frac{1}{\left(1-D\right)}-U_\mathrm{2}
        =\left( \frac{1}{D}-1\right) U_\mathrm{2}.
        \label{eq:ucapacitor}        
    \end{equation}
    The substitution of $U_\mathrm{C}$ in \eqref{eq:ucapacitor} leads to 
    \begin{equation}
        U_\mathrm{T,block}=\left( \frac{1}{D}-1\right) U_\mathrm{2}+U_\mathrm{2}=\frac{U_\mathrm{2}}{D}.
    \end{equation}
    The diode has to block the voltage, when the transistor is active. Applying Kirchhoff's loop rule yields:
    \begin{equation}
        U_\mathrm{C}+U_\mathrm{D,block}+U_\mathrm{2}=0.
    \end{equation}
    With the used loop direction (right turn) the diode blocks negative voltage, which leads to:
    \begin{equation}
        -U_\mathrm{D,block}=U_\mathrm{C}+U_\mathrm{2}.
    \end{equation}
    $U_\mathrm{C}$ corresponds to the input voltage $U_\mathrm{1}$, because the voltage transfer ratio of the SEPIC-topology
    is calculated by:
    \begin{equation}
        \frac{U_\mathrm{2}}{U_\mathrm{1}}= \frac{D}{1-D} \quad \Leftrightarrow \quad 
        U_\mathrm{1}=\frac{1-D}{D}U_\mathrm{2}=\left( \frac{1}{D}-1\right)U_\mathrm{2}=U_\mathrm{C}
    \end{equation}
    The result shows, that the transistor and the diode needs to block the sum of input and output voltage, 
    which is the same blocking voltage as for the transistors and diodes in a boost-buck converter.
\end{solutionblock}

\subtask{Derive the input and output current ripple $\Delta i_\mathrm{L_1}$ and $\Delta i_\mathrm{L_2}$ depending on the duty cycle.}

\begin{solutionblock}
    % Solution
    The current ripple depends on the duty cycle, switching period and inductor voltage. 
    If $T$ is active, the current through $L_1$ increases. This corresponds to the ripple current
    \begin{equation}
        \Delta i_\mathrm{L1}=\frac{U_\mathrm{1}D}{f_\mathrm{s}L_\mathrm{1}}.
    \end{equation}
    Also, for $L_2$ the current increases while $T$ is active. In this case the voltage of the capacitor $C$ is applied to $L_2$.
    The ripple current of $L_1$ is obtained by
    \begin{equation}
        \Delta i_\mathrm{L2}=\frac{U_\mathrm{C}D}{f_\mathrm{s}L_\mathrm{2}}=\frac{U_\mathrm{1}D}{f_\mathrm{s}L_\mathrm{2}}.
    \end{equation}
\end{solutionblock}

\subtask{To what minimum value can the output power be reduced while still ensuring continuous operation across the entire output voltage range? 
(i.e., continuous current flow in $L_\mathrm{1}$  and $L_\mathrm{2}$)?}

\begin{solutionblock}
    % Solution
    Both inductors have the same ripple current as long as they have the same inductance.
    For the inductor $L_1$ the power is the product of output voltage
     $U_\mathrm{2}$ and average current calculated by using \eqref{eq:Boostripple}:
    \begin{equation}
        P_\mathrm{min}=U_\mathrm{1}\frac{\Delta i_\mathrm{L1}}{2}D.
        \label{eq:PowerL1ripplesepic}
    \end{equation}
    \input{./fig/ex03/sFigTab_PowerminSepic} %Solution table Minimal Power 
    Entering the values in \eqref{eq:PowerL1ripplesepic} leads to \autoref{table:PowerminSepic}. The minimal power, which ensures continuous operation across the entire output voltage range yields $\SI{849}{\watt}$.

\end{solutionblock}

\subtask{Describe the advantages and disadvantages of the SEPIC topology 
compared to the boost-buck converter. Consider the necessary components 
and the quality of the output voltage.}


\begin{solutionblock}
    % Solution
    Advantages of SEPIC-topology compared to boost-buck converter:
    \begin{itemize}
        \item Minimal power limit is much lower (nearly factor 2).
        \item The amount of components are reduced (only 1 transistor and 1 diode is needed).
    \end{itemize}  
    Disadvantages of SEPIC-topology compared to boost-buck converter:
    \begin{itemize}
        \item The output current is pulsating (needs more filtering components).
    \end{itemize}  
\end{solutionblock}
